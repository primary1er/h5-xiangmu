<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>年轻婚态度，就要不一young！</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
	<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
	<script>
		var _czc = _czc || [];
		_czc.push(["_setAccount", "1262021144"]);
	</script>
</head>
<body>
	<div style="display: none;"><script src="https://s22.cnzz.com/z_stat.php?id=1262021144&web_id=1262021144" language="JavaScript"></script></div>
    <audio id="Jaudio" src="bgMusic.mp3" preload autoplay="autoplay" loop></audio>
    <div class="pageload">
        <div class="pageload_img"><img src="images/loading.gif" width="100%"></div>
        <div class="pageload_num" id="loadNum"></div>
    </div>
	<div class="allwarp">
    	<div class="pageopen">
        	<img class="img01" src="images/pup_begin_wri.png" width="100%">
        	<img class="img02" src="images/pup_begin_shou.png" width="100%">
        </div>
        <div class="pagewarp">
            <div class="page page_one">
                <ul class="pageInfo clearfix">
                    <li class="li_l page_one_l">
                        <div class="pagePup">
                        	<div class="jtBox"><img src="images/page_jt_l.png" width="100%"></div>
                            <div class="wriBox"><img src="images/page01_wri_l.png" width="100%"></div>
                            <div class="starBox"><img src="images/page_01_xx.png" width="100%"></div>
                        </div>
                    </li>
                    <li class="li_r page_one_r">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page01_wri_r.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_r.png" width="100%"></div>
                        </div>
                    </li>
                </ul>
				<img class="img03" src="images/pup_begin_tip.png">
            </div>
            <div class="page_btn"><img src="images/page_btn.png" width="100%" data-pageNum="0" class="pageBtn"></div>
        </div>
        <div class="pagewarp">
            <div class="page page_two">
                <ul class="pageInfo clearfix">
                    <li class="li_l page_two_l">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page02_wri_l.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_l.png" width="100%"></div>
                        </div>
                    </li>
                    <li class="li_r page_two_r">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page02_wri_r.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_r.png" width="100%"></div>
                            <div class="bottleBox"><img src="images/page_02_pz.png" width="100%"></div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="page_btn"><img src="images/page_btn.png" width="100%" data-pageNum="1" class="pageBtn"></div>
        </div>
        <div class="pagewarp">
            <div class="page page_three">
                <ul class="pageInfo clearfix">
                    <li class="li_l page_three_l">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page03_wri_l.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_l.png" width="100%"></div>
                            <div class="bjBox"><img src="images/page03_bj.jpg" width="100%"></div>
                            <div class="ppBox"><img src="images/page03_ren.png" width="100%"></div>
                            <div class="birdBox"><img src="images/page03_bird.png" width="100%"></div>
                            <div class="heavenBox cloudBox01"><img src="images/page03_cloud01.png" width="100%"></div>
                            <div class="heavenBox cloudBox02"><img src="images/page03_cloud02.png" width="100%"></div>
                            <div class="heavenBox sunBox"><img src="images/page03_sun.png" width="100%"></div>
                            <div class="starBox"><img src="images/page03_star.png" width="100%"></div>
                        </div>
                    </li>
                    <li class="li_r page_three_r">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page03_wri_r.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_r.png" width="100%"></div>
                            <div class="bgBox"><img src="images/page_03_r.jpg" width="100%"></div>
                            <div class="garbageBox"><img src="images/page03_garbage.png" width="100%"></div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="page_btn"><img src="images/page_btn.png" width="100%" data-pageNum="2" class="pageBtn"></div>
        </div>
        <div class="pagewarp">
            <div class="page page_four">
                <ul class="pageInfo clearfix">
                    <li class="li_l page_four_l">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page04_wri_l.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_l.png" width="100%"></div>
                            <div class="starBox"><img src="images/page04_star.png" width="100%"></div>
                        </div>
                    </li>
                    <li class="li_r page_four_r">
                        <div class="pagePup">
                            <div class="wriBox"><img src="images/page04_wri_r.png" width="100%"></div>
                        	<div class="jtBox"><img src="images/page_jt_r.png" width="100%"></div>
                            <div class="garbageBox"><img src="images/page04_garbage.png" width="100%"></div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="page_btn"><img src="images/page_btn.png" width="100%" data-pageNum="3" class="pageBtn"></div>
        </div>
        <div class="pagewarp">
        	<div class="pagelast">
            	<div class="logoBox"><img src="images/page_last_logo.png" width="100%"></div>
            	<div class="titBox">
                    <img src="images/page_last_k.png" width="100%">
                    <div class="douBox">
                        <img class="img_l" src="images/page_last_dou.png" width="100%">
                        <img class="img_r" src="images/page_last_dou.png" width="100%">
                    </div>
                </div>
                <div class="infoBox clearfix">
                    <div class="scrollBox scrollBox01">
                        <ul></ul>
                    </div>
                    <div class="scrollBox scrollBox02">
                        <ul></ul>
                    </div>
                </div>
                <div class="gzBtnBox"><img src="images/page_last_gzBtn.png" width="100%"></div>
            </div>
        </div>
        <div class="pup_warp"></div>
        <div class="pup_warp_res"></div>
        <div class="pup_gz">
        	<div class="pup_gz_tit"><img src="images/page_last_gz_tit.png" width="100%"></div>
        	<div class="pup_gz_in">
            	<div class="lineBox">
                	<div>
                        <h3>活动时间:</h3>
                        <p>2017年5月26日—6月26日</p>
                    </div>
                	<div>
                        <h3>参与方式:</h3>
                        <p>活动期间浏览“年轻婚态度，就要不一young”H5，参与摇一摇组词语，即可有机会获得微信红包，名额有限先到先得！</p>
                    </div>
                	<div>
                        <h3>活动须知:</h3>
                        <p>1.每位微信用户只可领取一次红包；</p>
                        <p>2.此次活动仅为宣传澳门旅行产品；</p>
                        <p>3.活动派发的红包金额由系统匹配随机；</p>
						<p>4.红包数量有限，先到先得。</p>
                    </div>
                </div>
            </div>
            <span class="pup_gz_btn"><img src="images/page_last_gz_close.png" width="100%"></span>
        </div>
        <!--pup_res01是成功组词，pup_res02是未成功组词，分别调取-->
        <div class="pup_res pup_res01">
        	<div class="resBox">
                <div class="bjBox"><img src="images/page_last_res_bj.png" width="100%"></div>
                <div class="intiiBox">恭喜你</div>
                <div class="inBox">
                    <p>成功组成词语，</p>
                    <p>现金红包已在你的微信零钱中！</p>
                    <p>“即刻出发”，</p>
					<p>体验澳门风情！</p>
                </div>
            </div>
            <div class="btnBox">
                <img class="img_l shareBtn" src="images/page_last_btn_03.png" width="100%">
                <a target="_blank" href="http://m.cits.cn/#/team/detail/04001588169"><img class="img_r" src="images/page_last_res_btn_r.png" width="100%" onclick="_czc.push(['_trackEvent','摇奖成功即刻出发','摇奖成功即刻出发']);"></a>
            </div>
        </div>
        <div class="pup_res pup_res02">
        	<div class="resBox">
                <div class="bjBox"><img src="images/page_last_res_bj.png" width="100%"></div>
                <div class="intiiBox">很遗憾</div>
                <div class="inBox">
                    <p>没能成功组成词语，</p>
                    <p>不要灰心，</p>
                    <p>再摇一次，</p>
					<p>即可有机会领取红包！</p>
                </div>
            </div>
            <div class="btnBox">
                <img class="img_l shareBtn" src="images/page_last_btn_03.png" width="100%">
				<img class="img_r againBtn" src="images/page_last_res_btn_l.png" width="100%">
            </div>
        </div>
        <div class="pup_share">
            <img src="images/page_last_share.png" width="100%">
            <span><img src="images/page_last_share_btn.png" width="100%" id="pupShareCloseBtn"></span>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
$(document).ready(function(e){
	//分享文案
	var app_title = "年轻婚态度，就要不一young！";
	var app_desc = "澳门旅拍，有态度，拒绝俗套，邀您共享浪漫风情！";
	var tl_title = "年轻婚态度，就要不一young！";

	//随机排列词语
	resetImgFn();
	var arrLen;
	function resetImgFn(){
		var arr_l = new Array();
		arr_l[0] = '<li data-str="旅" data-num="0"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_l_img01.png" width="100%"></div></div></li>';
		arr_l[1] = '<li data-str="澳" data-num="1"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_l_img02.png" width="100%"></div></div></li>';
		arr_l[2] = '<li data-str="婚" data-num="2"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_l_img03.png" width="100%"></div></div></li>';
		var len = arr_l.length;
		for(var i = 0; i < len - 1; i++){
			var idx = Math.floor(Math.random() * (len - i));
			var temp = arr_l[idx];
			arr_l[idx] = arr_l[len - i - 1];
			arr_l[len - i -1] = temp;
		}
		$(".scrollBox01 ul").html(arr_l[0]+arr_l[1]+arr_l[2]);
		var arr_r = new Array();
		arr_r[0] = '<li data-str="拍" data-num="0"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_r_img01.png" width="100%"></div></div></li>';
		arr_r[1] = '<li data-str="门" data-num="1"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_r_img02.png" width="100%"></div></div></li>';
		arr_r[2] = '<li data-str="纱" data-num="2"><div class="scrollwarp"><img class="bjBox" src="images/page_last_in_bg.png" width="100%"><div class="wriBox"><img src="images/page_last_scroll_r_img03.png" width="100%"></div></div></li>';
		var len = arr_r.length;
		for(var i = 0; i < len - 1; i++){
			var idx = Math.floor(Math.random() * (len - i));
			var temp = arr_r[idx];
			arr_r[idx] = arr_r[len - i - 1];
			arr_r[len - i -1] = temp;
		}
		$(".scrollBox02 ul").html(arr_r[0]+arr_r[1]+arr_r[2]);
		arrLen = $(".scrollBox02 ul li").length;
		$(".scrollBox01 ul li").clone().appendTo(".scrollBox01 ul");
		$(".scrollBox02 ul li").clone().appendTo(".scrollBox02 ul");
	}

	//===================================================================================================
	//定义用户抽奖的文字内容(后台可通过获取adjStrZ这个参数获取用户抽取的词语组合)
	var adjStrZ,adjStr01 = "",adjStr02 = "";
	//再来一遍
	$(".againBtn").click(function(){
		resetImgFn();
		$(".pup_warp_res,.pup_res").fadeOut();
		$(".scrollBox ul").css({"top":0});
		$(".scrollBox ul li").children(".scrollwarp").children(".bjBox").attr({"src":"images/page_last_in_bg.png"});
		shakeFlag = 0;
		adjStr01 = "";
		adjStr02 = "";
	});
	
	//摇一摇
	var yy = false;
	var shakeFlag = 0;
	function shake(){
		//运动事件监听
		if (window.DeviceMotionEvent) {
			window.addEventListener('devicemotion',deviceMotionHandler,false);
		}
		//获取加速度信息
		//通过监听上一步获取到的x, y, z 值在一定时间范围内的变化率，进行设备是否有进行晃动的判断。
		//而为了防止正常移动的误判，需要给该变化率设置一个合适的临界值。
		var SHAKE_THRESHOLD = 8000;
		var last_update = 0;
		var x, y, z, last_x = 0, last_y = 0, last_z = 0;
		function deviceMotionHandler(eventData) {
			var acceleration =eventData.accelerationIncludingGravity;
			var curTime = new Date().getTime();
			if ((curTime-last_update)> 10) {
				var diffTime = curTime -last_update;
				last_update = curTime;
				x = acceleration.x;
				y = acceleration.y;
				z = acceleration.z;
				var speed = Math.abs(x +y + z - last_x - last_y - last_z) / diffTime * 10000;
				if (speed > SHAKE_THRESHOLD) {
					if(shakeFlag==0){
						luckFn01();
						luckFn02();
						matchingFn();
						shakeFlag = 1;
					}
					yy = true;

				}
				last_x = x;
				last_y = y;
				last_z = z;
			}
		}
	}
	
	//抽奖
	var scrollLiHeight;
	var liImg = new Image();
	liImg.src = "images/page_last_in_bg.png";
	liImg.onload=function(){
		scrollheightTimer01 = setTimeout(function(){
			scrollLiHeight = parseInt($(".scrollBox li").height());
		},2000);
		scrollheightTimer02 = setTimeout(function(){
			$(".infoBox").height(scrollLiHeight*3);
		},3000);
	};   
	
	var mat01,mat02;
	function luckFn01(){
		var scrollTimer  = null;
		var scrollNum = 0;
		var scrollTop = 0;
		var scrollHeight = parseInt($(".scrollBox01 li").height());
		var scrollLenght = parseInt($(".scrollBox01 li").length);
		scrollTimer = setInterval(function(){
			scrollNum = scrollNum + 1;
			if(scrollNum>scrollLenght-3){
				//console.log("s");
				scrollNum = 1;
				$(".scrollBox01 ul").css({"top":0});
			}
			$(".scrollBox01 ul").stop().animate({"top":-(scrollNum*scrollHeight)},100);
		},100);
		
		//加了cur的li是我们抽奖的结果adjStr01是返回的相对应的文字
		var timer = setTimeout(function(){
			clearInterval(scrollTimer);
			$(".scrollBox01 ul li").animate({"padding":"0px"},10,function(){
				mat01 =  $(".scrollBox01 ul li").eq(scrollNum+1).attr("data-num");
				adjStr01 = $(".scrollBox01 ul li").eq(scrollNum+1).attr("data-str");
				$(".scrollBox01 ul li").eq(scrollNum+1).addClass("cur").children(".scrollwarp").children(".bjBox").attr({"src":"images/page_last_in_bg_hover.png"});
			})
		},2000);
	}
	function luckFn02(){
		var scrollTimer  = null;
		var scrollNum = 0;
		var scrollTop = 0;
		var scrollHeight = parseInt($(".scrollBox02 li").height());
		var scrollLenght = parseInt($(".scrollBox02 li").length);
		scrollTimer = setInterval(function(){
			scrollNum = scrollNum + 1;
			if(scrollNum>scrollLenght-3){
				//console.log("s");
				scrollNum = 1;
				$(".scrollBox02 ul").css({"top":0});
			}
			$(".scrollBox02 ul").stop().animate({"top":-(scrollNum*scrollHeight)},100);
		},100);
		
		//加了cur的li是我们抽奖的结果,adjStr02是返回的相对应的文字
		var timer = setTimeout(function(){
			clearInterval(scrollTimer);
			$(".scrollBox02 ul li").animate({"padding":"0px"},10,function(){
				mat02 =  $(".scrollBox02 ul li").eq(scrollNum+1).attr("data-num");
				adjStr02 = $(".scrollBox02 ul li").eq(scrollNum+1).attr("data-str");
				$(".scrollBox02 ul li").eq(scrollNum+1).addClass("cur").children(".scrollwarp").children(".bjBox").attr({"src":"images/page_last_in_bg_hover.png"});
			})
		},2000);
	}
	function matchingFn(){
		var matTiner = setTimeout(function(){
			if(mat01==mat02||mat01==2&&mat02==0){
				//adjStrZ是词语组合正确的抽取的词语
				adjStrZ = adjStr01 + adjStr02;
				fhb();
			}else{
				$(".pup_warp_res,.pup_res02").fadeIn();
				//fhb();
			}

		},3500);
	}
	function fhb(){
		$.post("./share.php",{"openid":"<?php echo $data['openid'];?>","adjStrZ":adjStrZ},function(res){
			var data = JSON.parse(res);
			if(data.status=="success"){
				alert(data.mess);
				app_desc = "<?php echo $data['nickname'];?>在本次澳门旅拍活动中，获得了一个令人羡慕的红包！";
				tl_title = "<?php echo $data['nickname'];?>在本次澳门旅拍活动中，获得了一个令人羡慕的红包！";
				wx.ready(function(){
					wx.error(function(res){
						console.log(res);
					});
					//朋友圈
					wx.onMenuShareTimeline({
						title: tl_title, 		// 分享标题
						link: link, 					// 分享链接
						imgUrl: DOMAIN+"/share.png",	// 分享图标
						success: function () {
							//用户分享成功后执行的回调函数
							_czc.push(['_trackEvent','分享朋友圈','分享朋友圈']);
						},
						cancel: function () {
							// 用户取消分享后执行的回调函数
						}
					});

					//分享给朋友
					wx.onMenuShareAppMessage({
						title: app_title, // 分享标题
						desc: app_desc, // 分享描述
						link: link, // 分享链接
						imgUrl: DOMAIN+"/share.png", // 分享图标
						type: '', // 分享类型,music、video或link，不填默认为link
						dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
						success: function () {
							//用户分享成功后执行的回调函数
							_czc.push(['_trackEvent','分享','分享']);
						},
						cancel: function () {
							// 用户取消分享后执行的回调函数
						}
					});
				});
				//alert("success:金额：");
			}else if(data.status=="error"){
				alert(data.mess);
				if(data.mess=="红包已领完!"){
					$('.pup_res01 .intiiBox').html("谢谢参与");
					$('.pup_res01 p').eq(1).html("您来晚一步，红包已被领完啦！");
				}
			}
			$(".pup_warp_res,.pup_res01").fadeIn();
		});
	}
	//规则弹窗开启按钮
	$(".gzBtnBox").click(function(){
		$(".pup_warp,.pup_gz").fadeIn();
	});
	
	var yyyFlag = 0;
	//规则弹窗关闭按钮
	$(".pup_gz_btn img").click(function(){
		$(".pup_warp,.pup_gz").fadeOut();
		if(yyyFlag==0){
			yyyFlag = 1;
			shake();
		}
	});
	//很遗憾分享按钮
	$(".shareBtn").click(function(){
		$(".pup_res").fadeOut();
		$(".pup_warp,.pup_share").fadeIn();
	});
	//分享关闭弹窗
	$("#pupShareCloseBtn").click(function(){
		if(mat01==mat02||mat01==2&&mat02==0){
			$(".pup_res01").fadeIn();
		}else{
			$(".pup_res02").fadeIn();
		}

		$(".pup_warp,.pup_share").fadeOut();
	});
	//微信分享=================================================================================================================================================================
	var DOMAIN="http://weixin.fengme.cc/app/marry";
	var URL = location.href.split('#')[0];
	URL = encodeURIComponent(URL);
	var link = location.origin+location.pathname;//+"?openid=";

	var shareConfig = {
		timestamp: Math.round(new Date() / 1000),
		nonceStr: Math.round(new Date() / 1000) + Math.random(),
		url:URL,
		shop_name:"",
		shop_id:"",
		share_url:""
	};

	$.get(DOMAIN+"/class/WeixinModel.class.php?act=jsSign&noncestr="+shareConfig.nonceStr+"&timestamp="+shareConfig.timestamp+"&url="+URL+"&refresh=", function(data, status){
		if(status == "success"){
			var data = JSON.parse(data);
			if(status == "success"){
				//微信分享
				wx.config({
					debug: false,
					appId: data.appid,
					timestamp: data.timestamp,
					nonceStr: data.noncestr,
					signature: data.sign,
					jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage']
				});
				wx.error(function(res){
					console.log(res);
				});
			}else{
				alert("微信签名失败，刷新页面重试！");
			}
		}
	});
	wx.ready(function(){
		wx.error(function(res){
			console.log(res);
		});
		//朋友圈
		wx.onMenuShareTimeline({
			title: tl_title, 		// 分享标题
			link: link, 					// 分享链接
			imgUrl: DOMAIN+"/share.png",	// 分享图标
			success: function () {
				//用户分享成功后执行的回调函数
				_czc.push(['_trackEvent','分享朋友圈','分享朋友圈']);
			},
			cancel: function () {
				// 用户取消分享后执行的回调函数
			}
		});

		//分享给朋友
		wx.onMenuShareAppMessage({
			title: app_title, // 分享标题
			desc: app_desc, // 分享描述
			link: link, // 分享链接
			imgUrl: DOMAIN+"/share.png", // 分享图标
			type: '', // 分享类型,music、video或link，不填默认为link
			dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
			success: function () {
				//用户分享成功后执行的回调函数
				_czc.push(['_trackEvent','分享','分享']);
			},
			cancel: function () {
				// 用户取消分享后执行的回调函数
			}
		});
	});
});


</script>